<div class="registration-history-container">
  <div class="header">
    <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="toggleAddForm()">
        <span *ngIf="!showAddForm">+ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà</span>
        <span *ngIf="showAddForm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
      </button>
      <button class="btn btn-secondary" (click)="goBack()">
        ‡∏Å‡∏•‡∏±‡∏ö
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="success-message" *ngIf="successMessage">
    {{ successMessage }}
  </div>
  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <!-- Add Registration Form -->
  <div class="add-registration-form" *ngIf="showAddForm">
    <div class="form-card">
      <h3>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà</h3>
      <form (ngSubmit)="addRegistration()" #registrationForm="ngForm">
        <div class="form-group">
          <label for="courseId">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
          <select
            id="courseId"
            name="courseId"
            [(ngModel)]="newRegistration.courseId"
            (change)="onCourseChange()"
            required
            class="form-control"
          >
            <option value="0">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <option *ngFor="let course of availableCourses" [value]="course.id">
              {{ course.name }} - {{ course.price | number }} ‡∏ö‡∏≤‡∏ó
            </option>
          </select>
        </div>

        <div class="form-group" *ngIf="newRegistration.courseId">
          <label for="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
          <select
            id="status"
            name="status"
            [(ngModel)]="newRegistration.status"
            required
            class="form-control"
          >
            <option *ngFor="let status of statusOptions" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
        </div>

        <div class="course-info" *ngIf="newRegistration.courseId">
          <div class="info-item">
            <strong>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™:</strong> {{ newRegistration.courseName }}
          </div>
          <div class="info-item">
            <strong>‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> {{ newRegistration.price | number }} ‡∏ö‡∏≤‡∏ó
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            [disabled]="isAddingRegistration || !registrationForm.form.valid"
            class="btn btn-primary"
          >
            <span *ngIf="isAddingRegistration">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
            <span *ngIf="!isAddingRegistration">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Statistics -->
  <div class="stats-section" *ngIf="!isLoading && registrationHistory.length > 0">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ getTotalRegistrations() }}</div>
        <div class="stat-label">‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="stat-card active">
        <div class="stat-number">{{ getActiveRegistrations() }}</div>
        <div class="stat-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
      </div>
      <div class="stat-card completed">
        <div class="stat-number">{{ getCompletedRegistrations() }}</div>
        <div class="stat-label">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
      </div>
      <div class="stat-card total-spent">
        <div class="stat-number">{{ getTotalSpent() | number }}</div>
        <div class="stat-label">‡∏ö‡∏≤‡∏ó‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
  </div>

  <!-- No Data -->
  <div class="no-data" *ngIf="!isLoading && registrationHistory.length === 0">
    <div class="no-data-icon">üìö</div>
    <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
    <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!</p>
  </div>

  <!-- Registration History by Year -->
  <div class="history-section" *ngIf="!isLoading && registrationHistory.length > 0">
    <div *ngFor="let year of getYearKeys()" class="year-section">
      <h3 class="year-title">‡∏õ‡∏µ {{ year }}</h3>
      <div class="registration-grid">
        <div
          *ngFor="let registration of getRegistrationsByYear()[year]"
          class="registration-card"
        >
          <div class="registration-header">
            <div class="course-name">{{ registration.courseName }}</div>
            <div 
              class="status-badge" 
              [style.background-color]="getStatusColor(registration.status)"
            >
              {{ getStatusLabel(registration.status) }}
            </div>
          </div>
          
          <div class="registration-details">
            <div class="detail-item">
              <span class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</span>
              <span class="detail-value">{{ formatDate(registration.registrationDate) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
              <span class="detail-value">{{ registration.price | number }} ‡∏ö‡∏≤‡∏ó</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏™:</span>
              <span class="detail-value">#{{ registration.courseId.toString().padStart(4, '0') }}</span>
            </div>
          </div>

          <div class="registration-footer">
            <div class="registration-id">
              ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£: #{{ registration.id.toString().padStart(6, '0') }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
